import {
	siAbletonlive,
	siAdobeaftereffects,
	siAlpinedotjs,
	siAndroidstudio,
	siAngular,
	siAnsible,
	siAppwrite,
	siArduino,
	siAstro,
	siAtom,
	siAdobeaudition,
	siAmazonaws,
	siMicrosoftazure,
	siGnubash,
	siBlender,
	siBootstrap,
	siNetbsd,
	siC,
	siCsharp,
	siCplusplus,
	siCrystal,
	siApachecassandra,
	siClojure,
	siCloudflare,
	siCmake,
	siCodepen,
	siCoffeescript,
	siCss3,
	siD3dotjs,
	siDart,
	siDeno,
	siDiscord,
	siDjango,
	siDocker,
	siDotnet,
	siAmazondynamodb,
	siEclipseide,
	siElectron,
	siElixir,
	siGnuemacs,
	siEmberdotjs,
	siExpress,
	siFastapi,
	siFigma,
	siFirebase,
	siFlask,
	siFlutter,
	siFortran,
	siGatsby,
	siGooglecloud,
	siGit,
	siGithub,
	siGithubactions,
	siGitlab,
	siGo,
	siGradle,
	siGodotengine,
	siGrafana,
	siGraphql,
	siGtk,
	siHaskell,
	siHaxe,
	siHeroku,
	siHibernate,
	siHtml5,
	siIntellijidea,
	siAdobeillustrator,
	siInstagram,
	siJavascript,
	siJenkins,
	siJest,
	siJquery,
	siJulia,
	siKotlin,
	siKubernetes,
	siLaravel,
	siLatex,
	siLinkedin,
	siLinux,
	siLit,
	siLua,
	siMarkdown,
	siMastodon,
	siMaterialdesign,
	siApachemaven,
	siMongodb,
	siMysql,
	siNeovim,
	siNestjs,
	siNetlify,
	siNextdotjs,
	siNginx,
	siNim,
	siNodedotjs,
	siNuxtdotjs,
	siOcaml,
	siOctave,
	siRedhatopenshift,
	siOpenstack,
	siPerl,
	siAdobephotoshop,
	siPhp,
	siPostgresql,
	siPowershell,
	siAdobepremierepro,
	siPrisma,
	siPrometheus,
	siPug,
	siPython,
	siPytorch,
	siQt,
	siR,
	siRubyonrails,
	siRaspberrypi,
	siReact,
	siReactivex,
	siRedis,
	siRedux,
	siRemix,
	siRollupdotjs,
	siRos,
	siRuby,
	siRust,
	siSass,
	siSolidity,
	siSpring,
	siSqlite,
	siStackoverflow,
	siStyledcomponents,
	siSupabase,
	siScala,
	siSelenium,
	siSketchup,
	siSvelte,
	siSvg,
	siSwift,
	siSymfony,
	siTailwindcss,
	siTauri,
	siTensorflow,
	siTwitter,
	siTypescript,
	siUnity,
	siUnrealengine,
	siV,
	siVercel,
	siVim,
	siVisualstudio,
	siVite,
	siVisualstudiocode,
	siVuedotjs,
	siWebassembly,
	siWebpack,
	siWindicss,
	siWordpress,
	siCloudflarepages,
	siAdobexd,
	siZig,
} from "simple-icons/icons"
const simple_icons = [
	siAbletonlive,
	siAdobeaftereffects,
	siAlpinedotjs,
	siAndroidstudio,
	siAngular,
	siAnsible,
	siAppwrite,
	siArduino,
	siAstro,
	siAtom,
	siAdobeaudition,
	siAmazonaws,
	siMicrosoftazure,
	siGnubash,
	siBlender,
	siBootstrap,
	siNetbsd,
	siC,
	siCsharp,
	siCplusplus,
	siCrystal,
	siApachecassandra,
	siClojure,
	siCloudflare,
	siCmake,
	siCodepen,
	siCoffeescript,
	siCss3,
	siD3dotjs,
	siDart,
	siDeno,
	siDiscord,
	siDjango,
	siDocker,
	siDotnet,
	siAmazondynamodb,
	siEclipseide,
	siElectron,
	siElixir,
	siGnuemacs,
	siEmberdotjs,
	siExpress,
	siFastapi,
	siFigma,
	siFirebase,
	siFlask,
	siFlutter,
	siFortran,
	siGatsby,
	siGooglecloud,
	siGit,
	siGithub,
	siGithubactions,
	siGitlab,
	siGo,
	siGradle,
	siGodotengine,
	siGrafana,
	siGraphql,
	siGtk,
	siHaskell,
	siHaxe,
	siHeroku,
	siHibernate,
	siHtml5,
	siIntellijidea,
	siAdobeillustrator,
	siInstagram,
	siJavascript,
	siJenkins,
	siJest,
	siJquery,
	siJulia,
	siKotlin,
	siKubernetes,
	siLaravel,
	siLatex,
	siLinkedin,
	siLinux,
	siLit,
	siLua,
	siMarkdown,
	siMastodon,
	siMaterialdesign,
	siApachemaven,
	siMongodb,
	siMysql,
	siNeovim,
	siNestjs,
	siNetlify,
	siNextdotjs,
	siNginx,
	siNim,
	siNodedotjs,
	siNuxtdotjs,
	siOcaml,
	siOctave,
	siRedhatopenshift,
	siOpenstack,
	siPerl,
	siAdobephotoshop,
	siPhp,
	siPostgresql,
	siPowershell,
	siAdobepremierepro,
	siPrisma,
	siPrometheus,
	siPug,
	siPython,
	siPytorch,
	siQt,
	siR,
	siRubyonrails,
	siRaspberrypi,
	siReact,
	siReactivex,
	siRedis,
	siRedux,
	siRemix,
	siRollupdotjs,
	siRos,
	siRuby,
	siRust,
	siSass,
	siSolidity,
	siSpring,
	siSqlite,
	siStackoverflow,
	siStyledcomponents,
	siSupabase,
	siScala,
	siSelenium,
	siSketchup,
	siSvelte,
	siSvg,
	siSwift,
	siSymfony,
	siTailwindcss,
	siTauri,
	siTensorflow,
	siTwitter,
	siTypescript,
	siUnity,
	siUnrealengine,
	siV,
	siVercel,
	siVim,
	siVisualstudio,
	siVite,
	siVisualstudiocode,
	siVuedotjs,
	siWebassembly,
	siWebpack,
	siWindicss,
	siWordpress,
	siCloudflarepages,
	siAdobexd,
	siZig,
]
const ONE_ICON = 48
const SCALE = ONE_ICON / (300 - 44)

/**
 * @param {import("simple-icons/icons").I[]} icons
 * @param {number} perLine
 */
function generateSvg(icons, perLine) {
	const length = Math.min(perLine * 300, icons.length * 300) - 44
	const height = Math.ceil(icons.length / perLine) * 300 - 44
	const scaledHeight = height * SCALE
	const scaledWidth = length * SCALE
	return `
	<svg class="moller" width="${scaledWidth}" height="${scaledHeight}" viewBox="0 0 ${length} ${height}" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
		<style>rect{fill:var(--bg)}</style>
		${[{ hex: "", path: "" }, ...icons] // insert dummy icon for 0 index to fix bug
			.map(
				(icon, index) =>
					`<g transform="translate(${((index - 1) % perLine) * 300}, ${
						Math.floor((index - 1) / perLine) * 300
					}) scale(10)" style="--bg:#${icon.hex};width:max-content">
					<rect width="24" height="24" rx="5"/>
					<path fill="white" d="${
						icon.path
					}" transform="scale(0.8)" style="transform-box:fill-box;transform-origin:center" />
					</g>`
			)
			.join("")}
	</svg>`
}

export default {
	/**
	 * @param {Request} request
	 */
	async fetch(request) {
		const url = new URL(request.url)
		const icon_param = (url.searchParams.get("icons") ?? "").split(",")
		const perLine = parseInt(url.searchParams.get("perLine") ?? "15")
		const icons = simple_icons.filter(icon => icon_param.includes(icon.slug))

		return new Response(generateSvg(icons, perLine), {
			headers: {
				"content-type": "image/svg+xml",
			},
		})
	},
}
